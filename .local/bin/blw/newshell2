#!/bin/bash

# Path to the image you want to display
IMAGE_PATH="/home/euler/Pictures/Wallpapers/pawel-czerwinski-3kvvTckVHhs-unsplash.jpg"

# Get terminal size and screen size
builtin read -r rows cols < <(command stty size)
IFS=x builtin read -r width height < <(command kitten icat --print-window-size)
builtin unset IFS

# Calculate 40% of the terminal width
image_width=$((cols * 10 / 100))

# Display the image using kitty's graphics protocol with the specified width
kitty +kitten icat --align left --scale-up --stdin no --transfer-mode stream --stdin no --place "${image_width}x${height}@0x0" $IMAGE_PATH

# Determine the height of the image displayed
image_height=$((image_width * height / cols))

# Answered by `choroba`
# https://stackoverflow.com/questions/70438735/i-would-like-to-concatenate-two-figlet-outputs-with-different-colors?noredirect=1#70439024
ORANGE="\e[37m" # 37 => white; 35 => pink/purple
BLUE="\e[0m"
GREEN="\e[31m" # 34 => cyan
STOP="\e[0m"

mapfile -t left  < <(figlet -f standard "Buddhi")
mapfile -t right < <(figlet -f standard "LW")

maxlength=0
for line in "${left[@]}" ; do
    if (( ${#line} > maxlength )) ; then
        maxlength=${#line}
    fi
done

printf "${GREEN}"
printf "%*s\n" $((image_width + 34)) "==================================="

for ((i=0; i<${#left[@]}+1; ++i)) ; do
    printf "${ORANGE}%*s ${GREEN}%s\n" $((image_width + maxlength)) "${left[i]}" "${right[i]}"
done | sed "$ d" | sed "$ d"

printf "${GREEN}"
printf "%*s\n" $((image_width + 34)) "======================================="
printf "${STOP}"

# Position the cursor to print the fortune below the image
fortune | lolcat -t
